# MCP Configuration

MCP (Model Context Protocol) settings for AI Agent integration.

## Quick Setup

Run the setup script from project root:

```bash
./set.sh
```

This will automatically:
1. Create Python virtual environment
2. Generate `mcp_setting.json` with correct paths
3. Setup necessary directories

## Manual Setup

1. Copy `mcp_setting.json.example` to `mcp_setting.json`
2. Replace `<PROJECT_PATH>` with your actual project path
3. Copy the content to your AI Agent settings

## Files

| File | Purpose |
|------|---------|
| `mcp_setting.json` | Active configuration (auto-generated by set.sh) |
| `mcp_setting.json.example` | Template with placeholders |

## MCP Servers

| Server | Package | Purpose |
|--------|---------|---------|
| mobile-mcp | `@mobilenext/mobile-mcp` | Android/iOS device control |
| filesystem | `@modelcontextprotocol/server-filesystem` | File read/write operations |
| fetch | `mcp-server-fetch` | Web content retrieval |
| context7 | `@upstash/context7-mcp` | Library documentation lookup |

### Optional: uiautomator2 MCP Server

For more precise Android automation, add `mcp-android-server`:

```bash
pip install mcp-android-server
```

Add to your MCP config:
```json
"mcp-android": {
  "command": "python",
  "args": ["-m", "mcp_android_server"]
}
```

**Benefits**:
- `click` by text/resourceId/description (no coordinate guessing)
- `wait_for_element` (reduces timing errors)
- `scroll_to` (auto-scroll to element)
- `dump_hierarchy` (full UI tree XML)

## Element-First Strategy (CRITICAL)

**Use accessibility tree before screenshots to improve speed and accuracy.**

```
FAST & RELIABLE:
1. mobile_list_elements_on_screen
2. Find target by text/type/identifier
3. Click at element center: (x + width/2, y + height/2)

SLOW & ERROR-PRONE (avoid):
1. mobile_take_screenshot
2. LLM guesses coordinates
3. Frequent misclicks â†’ retry loop
```

See `AGENTS.md` for detailed element-first guidelines.

## AI Agent Configuration

### Cursor

1. Open Settings (Cmd/Ctrl + ,)
2. Search for "MCP"
3. Add server configurations from `mcp_setting.json`

### Roo Code

Copy to `.roo/mcp.json` in your project root.

### Claude Code / Codex / GEMINI-CLI

Refer to each agent's MCP configuration documentation.

## Troubleshooting

### MCP Server Not Starting

```bash
# Check if npx/uvx are available
which npx
which uvx

# Test mobile-mcp manually
npx -y @mobilenext/mobile-mcp@latest
```

### Device Not Detected

```bash
# Check ADB connection
adb devices

# Restart ADB server
adb kill-server && adb start-server
```

## Notes

- See `AGENTS.md` in project root for AI Agent usage guidelines
- Python scripts in `src/` provide fallback when MCP tools are restricted
